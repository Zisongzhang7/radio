# 硬件接线图

## 📋 系统信息

- **主控板型号**: `bread-compact-wifi`
- **芯片**: ESP32-S3
- **项目**: xiaozhi-esp32-main

---

## 🔌 BMI160 六轴传感器模块

### 连接引脚

| BMI160 引脚 | ESP32 引脚 | 说明 |
|------------|-----------|------|
| **VIN** | 3.3V | 电源正极（3.3V供电） |
| **GND** | GND | 电源地 |
| **SCL** | **GPIO12** | I2C 时钟线 |
| **SDA** | **GPIO13** | I2C 数据线 |
| **CS** | 3.3V | 片选（拉高使用I2C模式） |
| **SAO** | GND | I2C地址选择（接GND = 0x68） |

### I2C 配置

```
I2C总线: I2C_NUM_0
I2C地址: 0x68 (7位地址)
时钟频率: 400 kHz
使能内部上拉: 是
```

### 接线图示

```
BMI160 传感器模块           ESP32-S3 开发板
┌────────────────┐         ┌──────────────────┐
│                │         │                  │
│  VIN  ●────────┼─────────┤ 3.3V             │
│  GND  ●────────┼─────────┤ GND              │
│  SCL  ●────────┼─────────┤ GPIO12 (I2C_SCL) │
│  SDA  ●────────┼─────────┤ GPIO13 (I2C_SDA) │
│  CS   ●────────┼─────────┤ 3.3V             │
│  SAO  ●────────┼─────────┤ GND              │
│                │         │                  │
└────────────────┘         └──────────────────┘
```

---

## 🎮 按键配置

基于 `bread-compact-wifi` 板型的标准按键：

| 按键名称 | GPIO 引脚 | 功能 |
|---------|----------|------|
| BOOT 按钮 | GPIO0 | 启动按钮 / 唤醒 |
| 触摸按钮 | GPIO1 | 触摸唤醒 |
| 音量+ | GPIO2 | 音量增加 |
| 音量- | GPIO42 | 音量减少 |

---

## 🔊 音频接口

| 功能 | GPIO 引脚 | 说明 |
|------|----------|------|
| I2S BCLK | (具体GPIO待确认) | 音频位时钟 |
| I2S LRCK | (具体GPIO待确认) | 音频左右声道时钟 |
| I2S DOUT | (具体GPIO待确认) | 音频数据输出 |
| I2S DIN | (具体GPIO待确认) | 音频数据输入（麦克风） |

---

## 📺 显示屏状态

**当前状态**: ❌ **已禁用**

原因：设备无显示组件，显示功能已在代码中禁用，使用 `NoDisplay` 替代。

原显示I2C配置（已停用）：
- I2C总线: I2C_NUM_0
- 显示类型: SSD1306 OLED

---

## ⚠️ GPIO 使用注意事项

### GPIO12 特别说明

**GPIO12** 在 ESP32 启动时有特殊作用：
- 启动时采样该引脚，用于设置 Flash 电压（VDD_SDIO）
- **默认（下拉/悬空）**: 3.3V Flash 电压
- **拉高**: 1.8V Flash 电压

**当前使用**: 作为 I2C_SCL，一般不影响启动（因为 BMI160 在启动时处于高阻态）

如果遇到启动问题，可以考虑改用其他 GPIO，推荐：
- GPIO14
- GPIO15
- GPIO16
- GPIO17
- GPIO18

### 已占用的 GPIO

| GPIO | 功能 | 模块 |
|------|------|------|
| GPIO0 | BOOT按钮 | 系统 |
| GPIO1 | 触摸按钮 | 按键 |
| GPIO2 | 音量+ | 按键 |
| GPIO12 | I2C_SCL | BMI160传感器 |
| GPIO13 | I2C_SDA | BMI160传感器 |
| GPIO42 | 音量- | 按键 |

---

## 🎯 传感器姿态控制功能

### 面定义（立方体模型）

```
         面5 (前侧)
         ↑ +Y
         │
  面4 ←───┼───→ 面3
  (左侧)  │    (右侧)
  -X      │       +X
         │
         ↓ -Y
        面6 (后侧)

    上: 面1 (+Z 正面)
    下: 面2 (-Z 背面)
```

### 姿态触发功能

| 朝上的面 | 编号 | 轴向 | 触发功能 |
|---------|------|------|---------|
| 正面 | 1 | +Z | 无 |
| **背面** | **2** | **-Z** | **🎤 进入AI对话模式** |
| 右侧 | 3 | +X | 无 |
| **左侧** | **4** | **-X** | **🎙️ 请求播客（看世界）** |
| 前侧 | 5 | +Y | 无 |
| 后侧 | 6 | -Y | 无 |

### 触发机制

- ✅ **首次触发**: 只在首次翻转到目标面（面2或面4）时触发
- ✅ **重置触发**: 翻转到其他面后，可再次触发
- ✅ **提示音**: 每次触发播放提示音（OGG_POPUP）
- ✅ **日志记录**: 记录所有姿态变化和触发事件

---

## 🔧 故障排查

### BMI160 传感器不工作

**检查步骤**:

1. **供电检查**
   ```bash
   用万用表测量 VIN 和 GND 之间电压 = 3.3V
   ```

2. **接线检查**
   - [ ] SCL 连接到 GPIO12
   - [ ] SDA 连接到 GPIO13
   - [ ] CS 连接到 3.3V（使能I2C模式）
   - [ ] SAO 连接到 GND（I2C地址=0x68）

3. **I2C 通讯检查**
   - 查看日志中是否有 "BMI160 Chip ID: 0xD1"
   - 如果显示 "I2C通讯失败"，检查接线和供电

4. **替换 GPIO 测试**
   - 如果 GPIO12/13 有问题，可改用 GPIO14/15

### 常见错误信息

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| "无法读取BMI160芯片ID" | I2C通讯失败 | 检查SCL/SDA接线 |
| "错误的芯片ID" | 设备不是BMI160 | 确认模块型号 |
| "I2C总线初始化失败" | GPIO配置错误 | 检查GPIO是否被占用 |
| "读取传感器数据失败" | 传感器未初始化 | 检查供电和初始化日志 |

---

## 📊 供电需求

| 组件 | 电压 | 电流 | 说明 |
|------|------|------|------|
| ESP32-S3 | 3.3V | ~500mA | 主控芯片 |
| BMI160 | 2.4-3.6V | ~5mA | 6轴传感器（工作时） |
| 总计 | 3.3V | ~505mA | USB供电充足 |

---

## 📁 相关文档

- **传感器集成指南**: `BMI160_SENSOR_GUIDE.md`
- **传感器快速开始**: `BMI160_快速开始.md`
- **姿态控制功能**: 本文档
- **项目主文档**: `README.md`

---

## 📝 版本历史

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2025-10-23 | 1.2 | 添加姿态控制功能说明 |
| 2025-10-23 | 1.1 | 更新GPIO为12/13 |
| 2025-10-23 | 1.0 | 初始版本，BMI160集成完成 |

---

**最后更新**: 2025年10月23日  
**板型**: bread-compact-wifi  
**传感器**: BMI160 六轴传感器（I2C模式）

