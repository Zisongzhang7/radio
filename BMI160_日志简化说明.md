# BMI160 传感器日志简化说明

## 更改日期
2025年10月23日

## 更改内容

### 1. 代码修改
**文件**: `main/sensor_manager.cc`

#### 修改点1：简化数据输出逻辑
- **位置**: SensorTask 函数（116-142行）
- **修改**: 只在检测到晃动时才打印传感器数据
- **效果**: 设备静止时不再持续输出日志

**修改前**：
```cpp
// 每500ms无论是否晃动都打印数据
ESP_LOGI(TAG, "加速度 [g]: X=%.3f, Y=%.3f, Z=%.3f...");
```

**修改后**：
```cpp
// 只在检测到晃动时打印
if (shaking) {
    ESP_LOGI(TAG, "=== 检测到晃动! ===");
    ESP_LOGI(TAG, "加速度 [g]: X=%.3f, Y=%.3f, Z=%.3f...");
}
```

#### 修改点2：降低初始化日志级别
将以下日志从 `INFO` 改为 `DEBUG`：
- 第51行：I2C总线初始化成功
- 第91行：传感器读取任务已启动  
- 第113行：开始读取BMI160传感器数据

**原因**: 这些是调试信息，正常使用时不需要显示

### 2. 文档更新
更新了以下文档以反映日志简化：
- `BMI160_SENSOR_GUIDE.md` - 详细技术文档
- `BMI160_快速开始.md` - 快速入门指南
- `BMI160_集成完成.txt` - 集成报告

## 使用说明

### 正常日志输出（设备静止）
```
I (1234) SensorManager: 初始化传感器管理器...
I (1250) BMI160: BMI160 Chip ID: 0xD1
I (1450) BMI160: BMI160 初始化成功!
I (1451) SensorManager: BMI160传感器初始化成功!
I (1452) main: 传感器系统初始化成功
[静止时无任何传感器数据输出，界面保持清爽]
```

### 晃动时的日志输出
```
I (5432) SensorManager: === 检测到晃动! ===
I (5432) SensorManager: 加速度 [g]: X=0.523, Y=0.412, Z=1.234 | 陀螺仪 [°/s]: X=125.42, Y=-98.34, Z=45.67
```

## 如何启用详细日志（调试时）

如果需要查看所有日志（包括DEBUG级别），可以通过以下方式：

### 方法1: 修改日志级别配置
编辑 `sdkconfig`，找到并修改：
```
CONFIG_LOG_DEFAULT_LEVEL=3  # 改为 4 (DEBUG级别)
```

### 方法2: 在代码中针对性启用
在 `main/sensor_manager.cc` 顶部添加：
```cpp
#ifdef CONFIG_LOG_DEFAULT_LEVEL_DEBUG
    esp_log_level_set(TAG, ESP_LOG_DEBUG);
#endif
```

### 方法3: 运行时设置
使用ESP-IDF监控命令：
```bash
idf.py monitor
# 按下 Ctrl+] 进入命令模式
# 输入: esp_log_level_set("SensorManager", ESP_LOG_DEBUG);
```

## 优势

✅ **界面清爽**: 静止时无冗余日志输出  
✅ **关注重点**: 只显示重要事件（晃动检测）  
✅ **易于调试**: 需要时仍可启用详细日志  
✅ **性能优化**: 减少不必要的日志输出操作  

## 功能保持

✅ 传感器仍然每500ms读取数据（后台持续监测）  
✅ 晃动检测功能完全正常  
✅ 错误信息正常显示  
✅ 所有核心功能不受影响  

## 如需恢复原始日志行为

如果需要恢复每500ms打印一次数据的行为：

1. 编辑 `main/sensor_manager.cc`
2. 在 SensorTask 函数中，将数据打印代码移出 `if (shaking)` 条件块
3. 重新编译和烧录

---

**总结**: 此次修改优化了日志输出，让监控界面更加清爽易读，同时保留了所有核心功能。

